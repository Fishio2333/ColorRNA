var XYZ={X:0,Y:0,Z:0};var xyY={x:0,y:0,Y:0};var Lab={L:0,a:0,b:0};var Luv={L:0,u:0,v:0};var LCHab={L:0,C:0,H:0};var LCHuv={L:0,C:0,H:0};var RGB={R:0,G:0,B:0};var CCT=5000;var DomWavelengthNm=0;var Gamma=1;var GammaRGB=1;var GammaRGBIndex=0;var RefWhite={X:0,Y:0,Z:0};var ScaleXYZ=false;var ScaleY=false;var ScaleRGB=false;var kE=216/24389;var kK=24389/27;var kKE=8;var AdaptationMethod=0;var RefWhiteRGB={X:0,Y:0,Z:0};var MtxRGB2XYZ={m00:1,m01:0,m02:0,m10:0,m11:1,m12:0,m20:0,m21:0,m22:1};var MtxXYZ2RGB={m00:1,m01:0,m02:0,m10:0,m11:1,m12:0,m20:0,m21:0,m22:1};var MtxToRGB={m00:1,m01:0,m02:0,m10:0,m11:1,m12:0,m20:0,m21:0,m22:1};var MtxFromRGB={m00:1,m01:0,m02:0,m10:0,m11:1,m12:0,m20:0,m21:0,m22:1};var MtxAdaptMa={m00:1,m01:0,m02:0,m10:0,m11:1,m12:0,m20:0,m21:0,m22:1};var MtxAdaptMaI={m00:1,m01:0,m02:0,m10:0,m11:1,m12:0,m20:0,m21:0,m22:1};var CIE1931StdObs_x=[0.0001299,0.0002321,0.0004149,0.0007416,0.001368,0.002236,0.004243,0.00765,0.01431,0.02319,0.04351,0.07763,0.13438,0.21477,0.2839,0.3285,0.34828,0.34806,0.3362,0.3187,0.2908,0.2511,0.19536,0.1421,0.09564,0.05795001,0.03201,0.0147,0.0049,0.0024,0.0093,0.0291,0.06327,0.1096,0.1655,0.2257499,0.2904,0.3597,0.4334499,0.5120501,0.5945,0.6784,0.7621,0.8425,0.9163,0.9786,1.0263,1.0567,1.0622,1.0456,1.0026,0.9384,0.8544499,0.7514,0.6424,0.5419,0.4479,0.3608,0.2835,0.2187,0.1649,0.1212,0.0874,0.0636,0.04677,0.0329,0.0227,0.01584,0.01135916,0.008110916,0.005790346,0.004109457,0.002899327,0.00204919,0.001439971,0.0009999493,0.0006900786,0.0004760213,0.0003323011,0.0002348261,0.0001661505,0.000117413,0.00008307527,0.00005870652,0.00004150994,0.00002935326,0.00002067383,0.00001455977,0.00001025398,0.000007221456,0.000005085868,0.000003581652,0.000002522525,0.000001776509,0.000001251141];var CIE1931StdObs_y=[0.000003917,0.000006965,0.00001239,0.00002202,0.000039,0.000064,0.00012,0.000217,0.000396,0.00064,0.00121,0.00218,0.004,0.0073,0.0116,0.01684,0.023,0.0298,0.038,0.048,0.06,0.0739,0.09098,0.1126,0.13902,0.1693,0.20802,0.2586,0.323,0.4073,0.503,0.6082,0.71,0.7932,0.862,0.9148501,0.954,0.9803,0.9949501,1,0.995,0.9786,0.952,0.9154,0.87,0.8163,0.757,0.6949,0.631,0.5668,0.503,0.4412,0.381,0.321,0.265,0.217,0.175,0.1382,0.107,0.0816,0.061,0.04458,0.032,0.0232,0.017,0.01192,0.00821,0.005723,0.004102,0.002929,0.002091,0.001484,0.001047,0.00074,0.00052,0.0003611,0.0002492,0.0001719,0.00012,0.0000848,0.00006,0.0000424,0.00003,0.0000212,0.00001499,0.0000106,0.0000074657,0.0000052578,0.0000037029,0.0000026078,0.0000018366,0.0000012934,9.1093e-7,6.4153e-7,4.5181e-7];var CIE1931StdObs_z=[0.0006061,0.001086,0.001946,0.003486,0.006450001,0.01054999,0.02005001,0.03621,0.06785001,0.1102,0.2074,0.3713,0.6456,1.0390501,1.3856,1.62296,1.74706,1.7826,1.77211,1.7441,1.6692,1.5281,1.28764,1.0419,0.8129501,0.6162,0.46518,0.3533,0.272,0.2123,0.1582,0.1117,0.07824999,0.05725001,0.04216,0.02984,0.0203,0.0134,0.008749999,0.005749999,0.0039,0.002749999,0.0021,0.0018,0.001650001,0.0014,0.0011,0.001,0.0008,0.0006,0.00034,0.00024,0.00019,0.0001,0.00004999999,0.00003,0.00002,0.00001,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];function Determinant3x3(a){var b=a.m00*(a.m22*a.m11-a.m21*a.m12)-a.m10*(a.m22*a.m01-a.m21*a.m02)+a.m20*(a.m12*a.m01-a.m11*a.m02);return(b)}function MtxInvert3x3(a,b){var c=1/Determinant3x3(a);b.m00=c*(a.m22*a.m11-a.m21*a.m12);b.m01=-c*(a.m22*a.m01-a.m21*a.m02);b.m02=c*(a.m12*a.m01-a.m11*a.m02);b.m10=-c*(a.m22*a.m10-a.m20*a.m12);b.m11=c*(a.m22*a.m00-a.m20*a.m02);b.m12=-c*(a.m12*a.m00-a.m10*a.m02);b.m20=c*(a.m21*a.m10-a.m20*a.m11);b.m21=-c*(a.m21*a.m00-a.m20*a.m01);b.m22=c*(a.m11*a.m00-a.m10*a.m01)}function MtxTranspose3x3(a){var b=a.m01;a.m01=a.m10;a.m10=b;b=a.m02;a.m02=a.m20;a.m20=b;b=a.m12;a.m12=a.m21;a.m21=b}function DominantWavelength(p,n,o,B){var g;var l=0;var G=[0,0];var k=[0,0];var u=[0,0];var i;var L=p-o;var K=n-B;if((L>=-0.000001)&&(L<=0.000001)&&(K>=-0.000001)&&(K<=0.000001)){return(0)}for(i=360;i<=830;i+=5){var A=(i-360)/5;var v=(i==830)?0:A+1;var J=5*v+360;var D=CIE1931StdObs_x[A]/(CIE1931StdObs_x[A]+CIE1931StdObs_y[A]+CIE1931StdObs_z[A]);var j=CIE1931StdObs_y[A]/(CIE1931StdObs_x[A]+CIE1931StdObs_y[A]+CIE1931StdObs_z[A]);var C=CIE1931StdObs_x[v]/(CIE1931StdObs_x[v]+CIE1931StdObs_y[v]+CIE1931StdObs_z[v]);var h=CIE1931StdObs_y[v]/(CIE1931StdObs_x[v]+CIE1931StdObs_y[v]+CIE1931StdObs_z[v]);var I=D-o;var H=j-B;var F=C-D;var E=h-j;var r=(L*H-K*I)/(K*F-L*E);if((r<0)||(r>=1)){continue}var q=(Math.abs(L)>=Math.abs(K))?((F*r+I)/L):((E*r+H)/K);G[l]=q;u[l]=i;k[l]=(J-i)*r+i;l+=1}if((u[1]==830)&&(G[1]>0)){g=-k[0]}else{g=(G[0]>=0)?k[0]:k[1]}return(g)}function ClearForm(a){a.XYZ_X.value="";a.XYZ_Y.value="";a.XYZ_Z.value="";a.xyY_x.value="";a.xyY_y.value="";a.xyY_Y.value="";a.Lab_L.value="";a.Lab_a.value="";a.Lab_b.value="";a.LCHab_L.value="";a.LCHab_C.value="";a.LCHab_H.value="";a.Luv_L.value="";a.Luv_u.value="";a.Luv_v.value="";a.LCHuv_L.value="";a.LCHuv_C.value="";a.LCHuv_H.value="";a.RGB_R.value="";a.RGB_G.value="";a.RGB_B.value="";a.K.value="";a.DomWavelength.value=""}function ButtonXYZ(a){GetRefWhite(a);GetRGBModel(a);GetGamma(a);GetAdaptation(a);GetXYZ(a);XYZ2xyY();XYZ2Lab();Lab2LCHab();XYZ2Luv();Luv2LCHuv();XYZ2RGB();XYZ2CCT();CalcDomWavelength();FillAllCells(a)}function ButtonxyY(a){GetRefWhite(a);GetRGBModel(a);GetGamma(a);GetAdaptation(a);GetxyY(a);xyY2XYZ();XYZ2Lab();Lab2LCHab();XYZ2Luv();Luv2LCHuv();XYZ2RGB();XYZ2CCT();CalcDomWavelength();FillAllCells(a)}function ButtonLab(a){GetRefWhite(a);GetRGBModel(a);GetGamma(a);GetAdaptation(a);GetLab(a);Lab2XYZ();XYZ2xyY();Lab2LCHab();XYZ2Luv();Luv2LCHuv();XYZ2RGB();XYZ2CCT();CalcDomWavelength();FillAllCells(a)}function ButtonLCHab(a){GetRefWhite(a);GetRGBModel(a);GetGamma(a);GetAdaptation(a);GetLCHab(a);LCHab2Lab();Lab2XYZ();XYZ2xyY();XYZ2Luv();Luv2LCHuv();XYZ2RGB();XYZ2CCT();CalcDomWavelength();FillAllCells(a)}function ButtonLuv(a){GetRefWhite(a);GetRGBModel(a);GetGamma(a);GetAdaptation(a);GetLuv(a);Luv2XYZ();XYZ2xyY();Luv2LCHuv();XYZ2Lab();Lab2LCHab();XYZ2RGB();XYZ2CCT();CalcDomWavelength();FillAllCells(a)}function ButtonLCHuv(a){GetRefWhite(a);GetRGBModel(a);GetGamma(a);GetAdaptation(a);GetLCHuv(a);LCHuv2Luv();Luv2XYZ();XYZ2xyY();XYZ2Lab();Lab2LCHab();XYZ2RGB();XYZ2CCT();CalcDomWavelength();FillAllCells(a)}function ButtonRGB(a){GetRefWhite(a);GetRGBModel(a);GetGamma(a);GetAdaptation(a);GetRGB(a);RGB2XYZ();XYZ2xyY();XYZ2Lab();Lab2LCHab();XYZ2Luv();Luv2LCHuv();XYZ2CCT();CalcDomWavelength();FillAllCells(a)}function ButtonCCT(a){GetRefWhite(a);GetRGBModel(a);GetGamma(a);GetAdaptation(a);GetCCT(a);CCT2XYZ();XYZ2xyY();XYZ2Lab();Lab2LCHab();XYZ2Luv();Luv2LCHuv();XYZ2RGB();CalcDomWavelength();FillAllCells(a)}function FillAllCells(a){FillXYZCells(a);FillxyYCells(a);a.Lab_L.value=Lab.L.toFixed(4);a.Lab_a.value=Lab.a.toFixed(4);a.Lab_b.value=Lab.b.toFixed(4);a.LCHab_L.value=LCHab.L.toFixed(4);a.LCHab_C.value=LCHab.C.toFixed(4);a.LCHab_H.value=LCHab.H.toFixed(4);a.Luv_L.value=Luv.L.toFixed(4);a.Luv_u.value=Luv.u.toFixed(4);a.Luv_v.value=Luv.v.toFixed(4);a.LCHuv_L.value=LCHuv.L.toFixed(4);a.LCHuv_C.value=LCHuv.C.toFixed(4);a.LCHuv_H.value=LCHuv.H.toFixed(4);FillRGBCells(a);a.K.value=((CCT>=(10000/6))&&(CCT<=25000))?CCT.toFixed(1):"";a.DomWavelength.value=(DomWavelengthNm!=0)?DomWavelengthNm.toFixed(1):"N/A"}function FillXYZCells(c){var b=(ScaleXYZ==false)?1:100;var a=(ScaleXYZ==false)?6:4;c.XYZ_X.value=(b*XYZ.X).toFixed(a);c.XYZ_Y.value=(b*XYZ.Y).toFixed(a);c.XYZ_Z.value=(b*XYZ.Z).toFixed(a)}function FillxyYCells(c){var b=(ScaleY==false)?1:100;var a=(ScaleY==false)?6:4;c.xyY_x.value=xyY.x.toFixed(6);c.xyY_y.value=xyY.y.toFixed(6);c.xyY_Y.value=(b*xyY.Y).toFixed(a)}function FillRGBCells(c){var b=(ScaleRGB==false)?1:255;var a=(ScaleRGB==false)?6:4;c.RGB_R.value=(b*RGB.R).toFixed(a);c.RGB_G.value=(b*RGB.G).toFixed(a);c.RGB_B.value=(b*RGB.B).toFixed(a)}function RGBModelChange(a){GetRGBModel(a);a.Gamma.selectedIndex=GammaRGBIndex}function GetXYZ(b){var a=(ScaleXYZ==false)?1:0.01;XYZ.X=a*GetNumber(b.XYZ_X.value);XYZ.Y=a*GetNumber(b.XYZ_Y.value);XYZ.Z=a*GetNumber(b.XYZ_Z.value);XYZ.X=(XYZ.X<0)?0:XYZ.X;XYZ.Y=(XYZ.Y<0)?0:XYZ.Y;XYZ.Z=(XYZ.Z<0)?0:XYZ.Z}function GetxyY(b){var a=(ScaleY==false)?1:0.01;xyY.x=GetNumber(b.xyY_x.value);xyY.y=GetNumber(b.xyY_y.value);xyY.Y=a*GetNumber(b.xyY_Y.value);xyY.Y=(xyY.Y<0)?0:xyY.Y}function GetLab(a){Lab.L=GetNumber(a.Lab_L.value);Lab.a=GetNumber(a.Lab_a.value);Lab.b=GetNumber(a.Lab_b.value);Lab.L=(Lab.L<0)?0:(Lab.L>100)?100:Lab.L}function GetLCHab(a){LCHab.L=GetNumber(a.LCHab_L.value);LCHab.C=GetNumber(a.LCHab_C.value);LCHab.H=GetNumber(a.LCHab_H.value);LCHab.L=(LCHab.L<0)?0:(LCHab.L>100)?100:LCHab.L;LCHab.C=(LCHab.C<0)?0:LCHab.C;while(LCHab.H<0){LCHab.H+=360}while(LCHab.H>=360){LCHab.H-=360}}function GetLuv(a){Luv.L=GetNumber(a.Luv_L.value);Luv.u=GetNumber(a.Luv_u.value);Luv.v=GetNumber(a.Luv_v.value);Luv.L=(Luv.L<0)?0:(Luv.L>100)?100:Luv.L}function GetLCHuv(a){LCHuv.L=GetNumber(a.LCHuv_L.value);LCHuv.C=GetNumber(a.LCHuv_C.value);LCHuv.H=GetNumber(a.LCHuv_H.value);LCHuv.L=(LCHuv.L<0)?0:(LCHuv.L>100)?100:LCHuv.L;LCHuv.C=(LCHuv.C<0)?0:LCHuv.C;while(LCHuv.H<0){LCHuv.H+=360}while(LCHuv.H>=360){LCHuv.H-=360}}function GetRGB(b){var a=(ScaleRGB==false)?1:(1/255);RGB.R=a*GetNumber(b.RGB_R.value);RGB.G=a*GetNumber(b.RGB_G.value);RGB.B=a*GetNumber(b.RGB_B.value)}function GetCCT(a){CCT=GetNumber(a.K.value)}function GetRefWhite(a){RefWhite.Y=1;switch(a.RefWhite.selectedIndex){case 0:RefWhite.X=1.0985;RefWhite.Z=0.35585;break;case 1:RefWhite.X=0.99072;RefWhite.Z=0.85223;break;case 2:RefWhite.X=0.98074;RefWhite.Z=1.18232;break;case 3:RefWhite.X=0.96422;RefWhite.Z=0.82521;break;case 4:RefWhite.X=0.95682;RefWhite.Z=0.92149;break;case 5:RefWhite.X=0.95047;RefWhite.Z=1.08883;break;case 6:RefWhite.X=0.94972;RefWhite.Z=1.22638;break;default:case 7:RefWhite.X=1;RefWhite.Z=1;break;case 8:RefWhite.X=0.99186;RefWhite.Z=0.67393;break;case 9:RefWhite.X=0.95041;RefWhite.Z=1.08747;break;case 10:RefWhite.X=1.00962;RefWhite.Z=0.6435;break}}function GetRGBModel(b){RefWhiteRGB.Y=1;var d,k,j,e,l,h;switch(b){case 0:d=0.64;k=0.33;j=0.21;e=0.71;l=0.15;h=0.06;RefWhiteRGB.X=0.95047;RefWhiteRGB.Z=1.08883;GammaRGB=2.2;GammaRGBIndex=2;break;case 1:d=0.625;k=0.34;j=0.28;e=0.595;l=0.155;h=0.07;RefWhiteRGB.X=0.95047;RefWhiteRGB.Z=1.08883;GammaRGB=1.8;GammaRGBIndex=1;break;case 2:d=0.7347;k=0.2653;j=0.215;e=0.775;l=0.13;h=0.035;RefWhiteRGB.X=0.96422;RefWhiteRGB.Z=0.82521;GammaRGB=2.2;GammaRGBIndex=2;break;case 3:d=0.6888;k=0.3112;j=0.1986;e=0.7551;l=0.1265;h=0.0352;RefWhiteRGB.X=0.96422;RefWhiteRGB.Z=0.82521;GammaRGB=2.2;GammaRGBIndex=2;break;case 4:d=0.64;k=0.33;j=0.28;e=0.65;l=0.15;h=0.06;RefWhiteRGB.X=0.95047;RefWhiteRGB.Z=1.08883;GammaRGB=2.2;GammaRGBIndex=2;break;case 5:d=0.735;k=0.265;j=0.274;e=0.717;l=0.167;h=0.009;RefWhiteRGB.X=1;RefWhiteRGB.Z=1;GammaRGB=2.2;GammaRGBIndex=2;break;case 6:d=0.63;k=0.34;j=0.295;e=0.605;l=0.15;h=0.075;RefWhiteRGB.X=0.96422;RefWhiteRGB.Z=0.82521;GammaRGB=1.8;GammaRGBIndex=1;break;case 7:d=0.696;k=0.3;j=0.215;e=0.765;l=0.13;h=0.035;RefWhiteRGB.X=0.96422;RefWhiteRGB.Z=0.82521;GammaRGB=2.2;GammaRGBIndex=2;break;case 8:d=0.67;k=0.33;j=0.21;e=0.71;l=0.14;h=0.08;RefWhiteRGB.X=0.96422;RefWhiteRGB.Z=0.82521;GammaRGB=0;GammaRGBIndex=4;break;case 9:d=0.695;k=0.305;j=0.26;e=0.7;l=0.11;h=0.005;RefWhiteRGB.X=0.96422;RefWhiteRGB.Z=0.82521;GammaRGB=2.2;GammaRGBIndex=2;break;case 10:d=0.67;k=0.33;j=0.21;e=0.71;l=0.14;h=0.08;RefWhiteRGB.X=0.98074;RefWhiteRGB.Z=1.18232;GammaRGB=2.2;GammaRGBIndex=2;break;case 11:d=0.64;k=0.33;j=0.29;e=0.6;l=0.15;h=0.06;RefWhiteRGB.X=0.95047;RefWhiteRGB.Z=1.08883;GammaRGB=2.2;GammaRGBIndex=2;break;case 12:d=0.7347;k=0.2653;j=0.1596;e=0.8404;l=0.0366;h=0.0001;RefWhiteRGB.X=0.96422;RefWhiteRGB.Z=0.82521;GammaRGB=1.8;GammaRGBIndex=1;break;case 13:d=0.63;k=0.34;j=0.31;e=0.595;l=0.155;h=0.07;RefWhiteRGB.X=0.95047;RefWhiteRGB.Z=1.08883;GammaRGB=2.2;GammaRGBIndex=2;break;case 14:d=0.64;k=0.33;j=0.3;e=0.6;l=0.15;h=0.06;RefWhiteRGB.X=0.95047;RefWhiteRGB.Z=1.08883;GammaRGB=-2.2;GammaRGBIndex=3;break;case 15:d=0.735;k=0.265;j=0.115;e=0.826;l=0.157;h=0.018;RefWhiteRGB.X=0.96422;RefWhiteRGB.Z=0.82521;GammaRGB=2.2;GammaRGBIndex=2;break}var c={m00:d/k,m01:j/e,m02:l/h,m10:1,m11:1,m12:1,m20:(1-d-k)/k,m21:(1-j-e)/e,m22:(1-l-h)/h};var g={m00:1,m01:0,m02:0,m10:0,m11:1,m12:0,m20:0,m21:0,m22:1};MtxInvert3x3(c,g);var a=RefWhiteRGB.X*g.m00+RefWhiteRGB.Y*g.m01+RefWhiteRGB.Z*g.m02;var f=RefWhiteRGB.X*g.m10+RefWhiteRGB.Y*g.m11+RefWhiteRGB.Z*g.m12;var i=RefWhiteRGB.X*g.m20+RefWhiteRGB.Y*g.m21+RefWhiteRGB.Z*g.m22;MtxRGB2XYZ.m00=a*c.m00;MtxRGB2XYZ.m01=f*c.m01;MtxRGB2XYZ.m02=i*c.m02;MtxRGB2XYZ.m10=a*c.m10;MtxRGB2XYZ.m11=f*c.m11;MtxRGB2XYZ.m12=i*c.m12;MtxRGB2XYZ.m20=a*c.m20;MtxRGB2XYZ.m21=f*c.m21;MtxRGB2XYZ.m22=i*c.m22;MtxTranspose3x3(MtxRGB2XYZ);MtxInvert3x3(MtxRGB2XYZ,MtxXYZ2RGB)}console.log("-----MtxXYZ2RGB-------");for(var ii=0;ii<16;ii++){var iii=ii;GetRGBModel(iii);console.log(iii+">>>>>>>>>>>>>>>>>>");var aaa=[[MtxXYZ2RGB.m00,MtxXYZ2RGB.m10,MtxXYZ2RGB.m20],[MtxXYZ2RGB.m01,MtxXYZ2RGB.m11,MtxXYZ2RGB.m21],[MtxXYZ2RGB.m02,MtxXYZ2RGB.m12,MtxXYZ2RGB.m22]];console.log(aaa);console.log("------------7");for(var z=0;z<aaa.length;z++){aaa[z][0]=+aaa[z][0].toFixed(7);aaa[z][1]=+aaa[z][1].toFixed(7);aaa[z][2]=+aaa[z][2].toFixed(7)}console.log(aaa)}console.log("------------4");for(var z=0;z<aaa.length;z++){aaa[z][0]=+aaa[z][0].toFixed(4);aaa[z][1]=+aaa[z][1].toFixed(4);aaa[z][2]=+aaa[z][2].toFixed(4)}console.log(aaa);function GetGamma(a){switch(a.Gamma.selectedIndex){case 0:Gamma=1;break;case 1:Gamma=1.8;break;case 2:Gamma=2.2;break;case 3:Gamma=-2.2;break;case 4:Gamma=0;break}}function GetAdaptation(a){AdaptationMethod=a;switch(AdaptationMethod){case 0:MtxAdaptMa.m00=0.8951;MtxAdaptMa.m01=-0.7502;MtxAdaptMa.m02=0.0389;MtxAdaptMa.m10=0.2664;MtxAdaptMa.m11=1.7135;MtxAdaptMa.m12=-0.0685;MtxAdaptMa.m20=-0.1614;MtxAdaptMa.m21=0.0367;MtxAdaptMa.m22=1.0296;MtxInvert3x3(MtxAdaptMa,MtxAdaptMaI);break;case 1:MtxAdaptMa.m00=0.40024;MtxAdaptMa.m01=-0.2263;MtxAdaptMa.m02=0;MtxAdaptMa.m10=0.7076;MtxAdaptMa.m11=1.16532;MtxAdaptMa.m12=0;MtxAdaptMa.m20=-0.08081;MtxAdaptMa.m21=0.0457;MtxAdaptMa.m22=0.91822;MtxInvert3x3(MtxAdaptMa,MtxAdaptMaI);break;case 2:case 3:MtxAdaptMa.m00=1;MtxAdaptMa.m01=0;MtxAdaptMa.m02=0;MtxAdaptMa.m10=0;MtxAdaptMa.m11=1;MtxAdaptMa.m12=0;MtxAdaptMa.m20=0;MtxAdaptMa.m21=0;MtxAdaptMa.m22=1;MtxAdaptMaI.m00=1;MtxAdaptMaI.m01=0;MtxAdaptMaI.m02=0;MtxAdaptMaI.m10=0;MtxAdaptMaI.m11=1;MtxAdaptMaI.m12=0;MtxAdaptMaI.m20=0;MtxAdaptMaI.m21=0;MtxAdaptMaI.m22=1;break}}GetAdaptation(3);var m=MtxAdaptMaI;var ma=[[m.m00,m.m01,m.m02],[m.m10,m.m11,m.m12],[m.m20,m.m21,m.m22]];console.log("----GetAdaptation-------");console.log(ma);console.log(ma[0][0],ma[0][1]);function XYZ2RGB(){var c=XYZ.X;var k=XYZ.Y;var g=XYZ.Z;if(AdaptationMethod!=3){var f=RefWhite.X*MtxAdaptMa.m00+RefWhite.Y*MtxAdaptMa.m10+RefWhite.Z*MtxAdaptMa.m20;var b=RefWhite.X*MtxAdaptMa.m01+RefWhite.Y*MtxAdaptMa.m11+RefWhite.Z*MtxAdaptMa.m21;var j=RefWhite.X*MtxAdaptMa.m02+RefWhite.Y*MtxAdaptMa.m12+RefWhite.Z*MtxAdaptMa.m22;var a=RefWhiteRGB.X*MtxAdaptMa.m00+RefWhiteRGB.Y*MtxAdaptMa.m10+RefWhiteRGB.Z*MtxAdaptMa.m20;var i=RefWhiteRGB.X*MtxAdaptMa.m01+RefWhiteRGB.Y*MtxAdaptMa.m11+RefWhiteRGB.Z*MtxAdaptMa.m21;var e=RefWhiteRGB.X*MtxAdaptMa.m02+RefWhiteRGB.Y*MtxAdaptMa.m12+RefWhiteRGB.Z*MtxAdaptMa.m22;var d=XYZ.X*MtxAdaptMa.m00+XYZ.Y*MtxAdaptMa.m10+XYZ.Z*MtxAdaptMa.m20;var l=XYZ.X*MtxAdaptMa.m01+XYZ.Y*MtxAdaptMa.m11+XYZ.Z*MtxAdaptMa.m21;var h=XYZ.X*MtxAdaptMa.m02+XYZ.Y*MtxAdaptMa.m12+XYZ.Z*MtxAdaptMa.m22;d*=(a/f);l*=(i/b);h*=(e/j);c=d*MtxAdaptMaI.m00+l*MtxAdaptMaI.m10+h*MtxAdaptMaI.m20;k=d*MtxAdaptMaI.m01+l*MtxAdaptMaI.m11+h*MtxAdaptMaI.m21;g=d*MtxAdaptMaI.m02+l*MtxAdaptMaI.m12+h*MtxAdaptMaI.m22}RGB.R=Compand(c*MtxXYZ2RGB.m00+k*MtxXYZ2RGB.m10+g*MtxXYZ2RGB.m20);RGB.G=Compand(c*MtxXYZ2RGB.m01+k*MtxXYZ2RGB.m11+g*MtxXYZ2RGB.m21);RGB.B=Compand(c*MtxXYZ2RGB.m02+k*MtxXYZ2RGB.m12+g*MtxXYZ2RGB.m22)}function RGB2XYZ(){var i=InvCompand(RGB.R);var l=InvCompand(RGB.G);var e=InvCompand(RGB.B);XYZ.X=i*MtxRGB2XYZ.m00+l*MtxRGB2XYZ.m10+e*MtxRGB2XYZ.m20;XYZ.Y=i*MtxRGB2XYZ.m01+l*MtxRGB2XYZ.m11+e*MtxRGB2XYZ.m21;XYZ.Z=i*MtxRGB2XYZ.m02+l*MtxRGB2XYZ.m12+e*MtxRGB2XYZ.m22;if(AdaptationMethod!=3){var a=RefWhite.X*MtxAdaptMa.m00+RefWhite.Y*MtxAdaptMa.m10+RefWhite.Z*MtxAdaptMa.m20;var k=RefWhite.X*MtxAdaptMa.m01+RefWhite.Y*MtxAdaptMa.m11+RefWhite.Z*MtxAdaptMa.m21;var g=RefWhite.X*MtxAdaptMa.m02+RefWhite.Y*MtxAdaptMa.m12+RefWhite.Z*MtxAdaptMa.m22;var h=RefWhiteRGB.X*MtxAdaptMa.m00+RefWhiteRGB.Y*MtxAdaptMa.m10+RefWhiteRGB.Z*MtxAdaptMa.m20;var b=RefWhiteRGB.X*MtxAdaptMa.m01+RefWhiteRGB.Y*MtxAdaptMa.m11+RefWhiteRGB.Z*MtxAdaptMa.m21;var j=RefWhiteRGB.X*MtxAdaptMa.m02+RefWhiteRGB.Y*MtxAdaptMa.m12+RefWhiteRGB.Z*MtxAdaptMa.m22;var f=XYZ.X*MtxAdaptMa.m00+XYZ.Y*MtxAdaptMa.m10+XYZ.Z*MtxAdaptMa.m20;var d=XYZ.X*MtxAdaptMa.m01+XYZ.Y*MtxAdaptMa.m11+XYZ.Z*MtxAdaptMa.m21;var c=XYZ.X*MtxAdaptMa.m02+XYZ.Y*MtxAdaptMa.m12+XYZ.Z*MtxAdaptMa.m22;f*=(a/h);d*=(k/b);c*=(g/j);XYZ.X=f*MtxAdaptMaI.m00+d*MtxAdaptMaI.m10+c*MtxAdaptMaI.m20;XYZ.Y=f*MtxAdaptMaI.m01+d*MtxAdaptMaI.m11+c*MtxAdaptMaI.m21;XYZ.Z=f*MtxAdaptMaI.m02+d*MtxAdaptMaI.m12+c*MtxAdaptMaI.m22}}function GetNumber(a){var b=parseFloat(a);return(isNaN(b)?0:b)}function Compand(b){var c;if(Gamma>0){c=(b>=0)?Math.pow(b,1/Gamma):-Math.pow(-b,1/Gamma)}else{if(Gamma<0){var a=1;if(b<0){a=-1;b=-b}c=(b<=0.0031308)?(b*12.92):(1.055*Math.pow(b,1/2.4)-0.055);c*=a}else{var a=1;if(b<0){a=-1;b=-b}c=(b<=(216/24389))?(b*24389/2700):(1.16*Math.pow(b,1/3)-0.16);c*=a}}return(c)}function InvCompand(c){var b;if(Gamma>0){b=(c>=0)?Math.pow(c,Gamma):-Math.pow(-c,Gamma)}else{if(Gamma<0){var a=1;if(c<0){a=-1;c=-c}b=(c<=0.04045)?(c/12.92):Math.pow((c+0.055)/1.055,2.4);b*=a}else{var a=1;if(c<0){a=-1;c=-c}b=(c<=0.08)?(2700*c/24389):((((1000000*c+480000)*c+76800)*c+4096)/1560896);b*=a}}return(b)}function XYZ2xyY(){Den=XYZ.X+XYZ.Y+XYZ.Z;if(Den>0){xyY.x=XYZ.X/Den;xyY.y=XYZ.Y/Den}else{xyY.x=RefWhite.X/(RefWhite.X+RefWhite.Y+RefWhite.Z);xyY.y=RefWhite.Y/(RefWhite.X+RefWhite.Y+RefWhite.Z)}xyY.Y=XYZ.Y}function XYZ2Lab(){var b=XYZ.X/RefWhite.X;var e=XYZ.Y/RefWhite.Y;var f=XYZ.Z/RefWhite.Z;var d=(b>kE)?Math.pow(b,1/3):((kK*b+16)/116);var c=(e>kE)?Math.pow(e,1/3):((kK*e+16)/116);var a=(f>kE)?Math.pow(f,1/3):((kK*f+16)/116);Lab.L=116*c-16;Lab.a=500*(d-c);Lab.b=200*(c-a)}function XYZ2Luv(){var e=XYZ.X+15*XYZ.Y+3*XYZ.Z;var a=(e>0)?((4*XYZ.X)/(XYZ.X+15*XYZ.Y+3*XYZ.Z)):0;var b=(e>0)?((9*XYZ.Y)/(XYZ.X+15*XYZ.Y+3*XYZ.Z)):0;var f=(4*RefWhite.X)/(RefWhite.X+15*RefWhite.Y+3*RefWhite.Z);var d=(9*RefWhite.Y)/(RefWhite.X+15*RefWhite.Y+3*RefWhite.Z);var c=XYZ.Y/RefWhite.Y;Luv.L=(c>kE)?(116*Math.pow(c,1/3)-16):(kK*c);Luv.u=13*Luv.L*(a-f);Luv.v=13*Luv.L*(b-d)}function xyY2XYZ(){if(xyY.y<0.000001){XYZ.X=XYZ.Y=XYZ.Z=0}else{XYZ.X=(xyY.x*xyY.Y)/xyY.y;XYZ.Y=xyY.Y;XYZ.Z=((1-xyY.x-xyY.y)*xyY.Y)/xyY.y}}function Lab2XYZ(){var e=(Lab.L+16)/116;var g=0.002*Lab.a+e;var d=e-0.005*Lab.b;var a=g*g*g;var c=d*d*d;var b=(a>kE)?a:((116*g-16)/kK);var f=(Lab.L>kKE)?Math.pow((Lab.L+16)/116,3):(Lab.L/kK);var h=(c>kE)?c:((116*d-16)/kK);XYZ.X=b*RefWhite.X;XYZ.Y=f*RefWhite.Y;XYZ.Z=h*RefWhite.Z}function Lab2LCHab(){LCHab.L=Lab.L;LCHab.C=Math.sqrt(Lab.a*Lab.a+Lab.b*Lab.b);LCHab.H=180*Math.atan2(Lab.b,Lab.a)/Math.PI;if(LCHab.H<0){LCHab.H+=360}}function LCHab2Lab(){Lab.L=LCHab.L;Lab.a=LCHab.C*Math.cos(LCHab.H*Math.PI/180);Lab.b=LCHab.C*Math.sin(LCHab.H*Math.PI/180)}function Luv2XYZ(){XYZ.Y=(Luv.L>kKE)?Math.pow((Luv.L+16)/116,3):(Luv.L/kK);var i=(4*RefWhite.X)/(RefWhite.X+15*RefWhite.Y+3*RefWhite.Z);var f=(9*RefWhite.Y)/(RefWhite.X+15*RefWhite.Y+3*RefWhite.Z);var g=(((52*Luv.L)/(Luv.u+13*Luv.L*i))-1)/3;var e=-5*XYZ.Y;var j=-1/3;var h=XYZ.Y*(((39*Luv.L)/(Luv.v+13*Luv.L*f))-5);XYZ.X=(h-e)/(g-j);XYZ.Z=XYZ.X*g+e}function Luv2LCHuv(){LCHuv.L=Luv.L;LCHuv.C=Math.sqrt(Luv.u*Luv.u+Luv.v*Luv.v);LCHuv.H=180*Math.atan2(Luv.v,Luv.u)/Math.PI;if(LCHuv.H<0){LCHuv.H+=360}}function LCHuv2Luv(){Luv.L=LCHuv.L;Luv.u=LCHuv.C*Math.cos(LCHuv.H*Math.PI/180);Luv.v=LCHuv.C*Math.sin(LCHuv.H*Math.PI/180)}function CCT2XYZ(){var h=CCT;var f=2*Math.PI*6.626176*2.99792458*2.99792458;var d=(6.626176*2.99792458)/1.380662;var a;var b=0;XYZ.X=0;XYZ.Y=0;XYZ.Z=0;for(a=360;a<=830;a+=5){var c=a*0.001;var g=c*c*c*c*c;var e=f/(g*1e-12*(Math.exp(d/(h*c*0.001))-1));XYZ.X+=(e*CIE1931StdObs_x[b]);XYZ.Y+=(e*CIE1931StdObs_y[b]);XYZ.Z+=(e*CIE1931StdObs_z[b]);b++}XYZ.X/=XYZ.Y;XYZ.Z/=XYZ.Y;XYZ.Y=1}function CalcDomWavelength(){DomWavelengthNm=DominantWavelength(xyY.x,xyY.y,RefWhite.X/(RefWhite.X+RefWhite.Y+RefWhite.Z),RefWhite.Y/(RefWhite.X+RefWhite.Y+RefWhite.Z))}function XYZ2CCT(){var b=[0,0.00001,0.00002,0.00003,0.00004,0.00005,0.00006,0.00007,0.00008,0.00009,0.0001,0.000125,0.00015,0.000175,0.0002,0.000225,0.00025,0.000275,0.0003,0.000325,0.00035,0.000375,0.0004,0.000425,0.00045,0.000475,0.0005,0.000525,0.00055,0.000575,0.0006];var g=[0.18006,0.18066,0.18133,0.18208,0.18293,0.18388,0.18494,0.18611,0.1874,0.1888,0.19032,0.19462,0.19962,0.20525,0.21142,0.21807,0.22511,0.23247,0.2401,0.24792,0.25591,0.264,0.27218,0.28039,0.28863,0.29685,0.30505,0.3132,0.32129,0.32931,0.33724];var f=[0.26352,0.26589,0.26846,0.27119,0.27407,0.27709,0.28021,0.28342,0.28668,0.28997,0.29326,0.30141,0.30921,0.31647,0.32312,0.32909,0.33439,0.33904,0.34308,0.34655,0.34951,0.352,0.35407,0.35577,0.35714,0.35823,0.35907,0.35968,0.36011,0.36038,0.36051];var h=[-0.24341,-0.25479,-0.26876,-0.28539,-0.3047,-0.32675,-0.35156,-0.37915,-0.40955,-0.44278,-0.47888,-0.58204,-0.70471,-0.84901,-1.0182,-1.2168,-1.4512,-1.7298,-2.0637,-2.4681,-2.9641,-3.5814,-4.3633,-5.3762,-6.7262,-8.5955,-11.324,-15.628,-23.325,-40.77,-116.45];us=(4*XYZ.X)/(XYZ.X+15*XYZ.Y+3*XYZ.Z);vs=(6*XYZ.Y)/(XYZ.X+15*XYZ.Y+3*XYZ.Z);var a=0;var d=0;var c=0;for(c=0;c<31;c++){d=(vs-f[c])-h[c]*(us-g[c]);if((c==0)&&(d<=0)){CCT=-10;return}if((c>0)&&(d<=0)){break}a=d}if(c==31){CCT=-10}else{var j=d/Math.sqrt(1+h[c]*h[c]);var e=a/Math.sqrt(1+h[c-1]*h[c-1]);w=e/(e-j);CCT=1/((b[c]-b[c-1])*w+b[c-1])}}function XYZCheckBox(b){ScaleXYZ=(ScaleXYZ==true)?false:true;var a=(ScaleXYZ==false)?0.01:1;XYZ.X=a*GetNumber(b.XYZ_X.value);XYZ.Y=a*GetNumber(b.XYZ_Y.value);XYZ.Z=a*GetNumber(b.XYZ_Z.value);FillXYZCells(b)}function YCheckBox(b){ScaleY=(ScaleY==true)?false:true;var a=(ScaleY==false)?0.01:1;xyY.Y=a*GetNumber(b.xyY_Y.value);FillxyYCells(b)}function RGBCheckBox(b){ScaleRGB=(ScaleRGB==true)?false:true;var a=(ScaleRGB==false)?(1/255):1;RGB.R=a*GetNumber(b.RGB_R.value);RGB.G=a*GetNumber(b.RGB_G.value);RGB.B=a*GetNumber(b.RGB_B.value);FillRGBCells(b)};